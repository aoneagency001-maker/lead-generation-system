# üì° API Documentation - Lead Generation System

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 18.11.2025 04:38


–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API –¥–ª—è Lead Generation System.

**Base URL:** `http://localhost:8000`  
**API Version:** 0.1.0  
**Swagger UI:** http://localhost:8000/docs  
**ReDoc:** http://localhost:8000/redoc

---

## üîç –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ API –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å API key authentication.

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤
–í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –û—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ HTTP —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–∞–º–∏.

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫
- `200` - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
- `404` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## üè• Health Check

### GET /api/health
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–∏—Å—Ç–µ–º—ã.

**Response:**
```json
{
  "status": "healthy",
  "services": {
    "database": "connected",
    "redis": "connected"
  },
  "version": "0.1.0"
}
```

---

## üìä Niches (–ù–∏—à–∏)

### POST /api/niches
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –Ω–∏—à—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**Request Body:**
```json
{
  "name": "–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
  "category": "electronics_repair",
  "description": "–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤ –≤—Å–µ—Ö –º–∞—Ä–æ–∫",
  "cpl_target": 500.0,
  "roi_target": 300.0
}
```

**Response:**
```json
{
  "id": "uuid-here",
  "name": "–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
  "category": "electronics_repair",
  "status": "research",
  "cpl_target": 500.0,
  "roi_target": 300.0,
  "created_at": "2024-11-17T10:00:00Z"
}
```

### GET /api/niches
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∏—à.

**Query Parameters:**
- `status` (optional) - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É: `research`, `active`, `paused`, `completed`, `rejected`
- `limit` (optional, default: 100) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

**Response:**
```json
[
  {
    "id": "uuid-1",
    "name": "–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
    "category": "electronics_repair",
    "status": "active",
    "cpl_target": 500.0,
    "roi_target": 300.0,
    "created_at": "2024-11-17T10:00:00Z"
  }
]
```

### GET /api/niches/{niche_id}
–ü–æ–ª—É—á–∏—Ç—å –Ω–∏—à—É –ø–æ ID.

**Response:**
```json
{
  "id": "uuid-here",
  "name": "–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
  "category": "electronics_repair",
  "status": "active",
  "cpl_target": 500.0,
  "roi_target": 300.0,
  "created_at": "2024-11-17T10:00:00Z"
}
```

### PATCH /api/niches/{niche_id}
–û–±–Ω–æ–≤–∏—Ç—å –Ω–∏—à—É.

**Request Body:**
```json
{
  "name": "–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤",
  "status": "active",
  "cpl_target": 450.0
}
```

**Response:** –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –Ω–∏—à–∞

### DELETE /api/niches/{niche_id}
–£–¥–∞–ª–∏—Ç—å –Ω–∏—à—É.

**Response:**
```json
{
  "message": "–ù–∏—à–∞ —É–¥–∞–ª–µ–Ω–∞",
  "id": "uuid-here"
}
```

---

## üéØ Campaigns (–ö–∞–º–ø–∞–Ω–∏–∏)

### POST /api/campaigns
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞–º–ø–∞–Ω–∏—é.

**Request Body:**
```json
{
  "niche_id": "uuid-here",
  "name": "OLX –ê–ª–º–∞—Ç—ã - –†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
  "platform": "olx",
  "budget": 50000.0,
  "start_date": "2024-11-20",
  "end_date": "2024-12-20"
}
```

**–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:** `olx`, `kaspi`, `telegram`, `whatsapp`

**Response:**
```json
{
  "id": "uuid-here",
  "niche_id": "uuid-here",
  "name": "OLX –ê–ª–º–∞—Ç—ã - –†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
  "platform": "olx",
  "status": "draft",
  "budget": 50000.0,
  "spent": 0.0,
  "ads_count": 0,
  "leads_count": 0,
  "created_at": "2024-11-17T10:00:00Z"
}
```

### GET /api/campaigns
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π.

**Query Parameters:**
- `niche_id` (optional) - –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∏—à–µ
- `platform` (optional) - –§–∏–ª—å—Ç—Ä –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

**Response:**
```json
[
  {
    "id": "uuid-here",
    "niche_id": "uuid-here",
    "name": "OLX –ê–ª–º–∞—Ç—ã - –†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
    "platform": "olx",
    "status": "active",
    "budget": 50000.0,
    "spent": 15000.0,
    "ads_count": 5,
    "leads_count": 12,
    "created_at": "2024-11-17T10:00:00Z"
  }
]
```

### GET /api/campaigns/{campaign_id}
–ü–æ–ª—É—á–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

**Response:**
```json
{
  "id": "uuid-here",
  "niche_id": "uuid-here",
  "name": "OLX –ê–ª–º–∞—Ç—ã - –†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
  "platform": "olx",
  "status": "active",
  "budget": 50000.0,
  "spent": 15000.0,
  "ads_count": 5,
  "leads_count": 12,
  "created_at": "2024-11-17T10:00:00Z",
  "stats": {
    "total_leads": 12,
    "qualified_leads": 4,
    "cpl": 1250.0,
    "conversion_rate": 33.3
  }
}
```

### PATCH /api/campaigns/{campaign_id}/status
–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–∞–º–ø–∞–Ω–∏–∏.

**Request Body:**
```json
{
  "status": "active"
}
```

**–°—Ç–∞—Ç—É—Å—ã:** `draft`, `active`, `paused`, `completed`, `failed`

**Response:** –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è

---

## üë• Leads (–õ–∏–¥—ã)

### POST /api/leads
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞.

**Request Body:**
```json
{
  "ad_id": "uuid-here",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "phone": "+7 777 123 4567",
  "source": "whatsapp",
  "platform_user_id": "user123",
  "budget": 15000.0,
  "notes": "–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è —Ä–µ–º–æ–Ω—Ç–æ–º MacBook"
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:** `olx`, `kaspi`, `telegram`, `whatsapp`

**Response:**
```json
{
  "id": "uuid-here",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "phone": "+7 777 123 4567",
  "source": "whatsapp",
  "status": "new",
  "quality_score": null,
  "created_at": "2024-11-17T10:00:00Z"
}
```

### GET /api/leads
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤.

**Query Parameters:**
- `status` (optional) - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É: `new`, `contacted`, `qualified`, `hot`, `won`, `lost`, `spam`
- `source` (optional) - –§–∏–ª—å—Ç—Ä –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É
- `limit` (optional, default: 100) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

**Response:**
```json
[
  {
    "id": "uuid-here",
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "phone": "+7 777 123 4567",
    "source": "whatsapp",
    "status": "qualified",
    "quality_score": 85,
    "created_at": "2024-11-17T10:00:00Z"
  }
]
```

### GET /api/leads/{lead_id}
–ü–æ–ª—É—á–∏—Ç—å –ª–∏–¥–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –æ–±—â–µ–Ω–∏—è.

**Response:**
```json
{
  "id": "uuid-here",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "phone": "+7 777 123 4567",
  "source": "whatsapp",
  "status": "qualified",
  "quality_score": 85,
  "created_at": "2024-11-17T10:00:00Z",
  "conversations": [
    {
      "id": "uuid-msg-1",
      "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ä–µ–º–æ–Ω—Ç MacBook",
      "sender": "lead",
      "platform": "whatsapp",
      "created_at": "2024-11-17T10:05:00Z"
    },
    {
      "id": "uuid-msg-2",
      "message": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?",
      "sender": "bot",
      "platform": "whatsapp",
      "created_at": "2024-11-17T10:05:30Z"
    }
  ]
}
```

### PATCH /api/leads/{lead_id}/status
–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ª–∏–¥–∞.

**Request Body:**
```json
{
  "status": "qualified"
}
```

**–°—Ç–∞—Ç—É—Å—ã:** `new`, `contacted`, `qualified`, `hot`, `won`, `lost`, `spam`

**Response:** –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ª–∏–¥

### POST /api/leads/{lead_id}/messages
–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é –æ–±—â–µ–Ω–∏—è.

**Request Body:**
```json
{
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ä–µ–º–æ–Ω—Ç MacBook",
  "sender": "lead",
  "platform": "whatsapp"
}
```

**–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–∏:** `bot`, `lead`, `human`  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:** `whatsapp`, `telegram`, `olx`, `kaspi`

**Response:**
```json
{
  "id": "uuid-msg-here",
  "lead_id": "uuid-here",
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ä–µ–º–æ–Ω—Ç MacBook",
  "sender": "lead",
  "platform": "whatsapp",
  "created_at": "2024-11-17T10:05:00Z"
}
```

### GET /api/leads/{lead_id}/messages
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–∏–¥–∞.

**Response:**
```json
{
  "lead_id": "uuid-here",
  "messages": [
    {
      "id": "uuid-msg-1",
      "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ä–µ–º–æ–Ω—Ç MacBook",
      "sender": "lead",
      "platform": "whatsapp",
      "created_at": "2024-11-17T10:05:00Z"
    }
  ]
}
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### cURL

**–°–æ–∑–¥–∞—Ç—å –Ω–∏—à—É:**
```bash
curl -X POST http://localhost:8000/api/niches \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
    "category": "electronics_repair",
    "description": "–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
    "cpl_target": 500.0,
    "roi_target": 300.0
  }'
```

**–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é:**
```bash
curl -X POST http://localhost:8000/api/campaigns \
  -H "Content-Type: application/json" \
  -d '{
    "niche_id": "uuid-here",
    "name": "OLX –ê–ª–º–∞—Ç—ã - –†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
    "platform": "olx",
    "budget": 50000.0
  }'
```

**–°–æ–∑–¥–∞—Ç—å –ª–∏–¥:**
```bash
curl -X POST http://localhost:8000/api/leads \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "phone": "+7 777 123 4567",
    "source": "whatsapp",
    "budget": 15000.0
  }'
```

### Python (httpx)

```python
import httpx

async with httpx.AsyncClient() as client:
    # –°–æ–∑–¥–∞—Ç—å –Ω–∏—à—É
    response = await client.post(
        "http://localhost:8000/api/niches",
        json={
            "name": "–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤",
            "category": "electronics_repair",
            "cpl_target": 500.0
        }
    )
    niche = response.json()
    
    # –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
    response = await client.post(
        "http://localhost:8000/api/campaigns",
        json={
            "niche_id": niche["id"],
            "name": "OLX –ê–ª–º–∞—Ç—ã",
            "platform": "olx",
            "budget": 50000.0
        }
    )
    campaign = response.json()
```

### JavaScript (fetch)

```javascript
// –°–æ–∑–¥–∞—Ç—å –Ω–∏—à—É
const response = await fetch('http://localhost:8000/api/niches', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    name: '–†–µ–º–æ–Ω—Ç –Ω–æ—É—Ç–±—É–∫–æ–≤',
    category: 'electronics_repair',
    cpl_target: 500.0
  })
});

const niche = await response.json();
```

---

## üîÑ WebSocket (–ë—É–¥—É—â–µ–µ)

–í –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ WebSocket –¥–ª—è:
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤ –∫–∞–º–ø–∞–Ω–∏–π
- Live —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö
- Real-time —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

---

## üìä Rate Limiting

–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ rate limiting –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω. –í production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP
- 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å –Ω–∞ API key

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production:
1. –î–æ–±–∞–≤–∏—Ç—å API key authentication
2. –í–∫–ª—é—á–∏—Ç—å HTTPS
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
4. –î–æ–±–∞–≤–∏—Ç—å rate limiting
5. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ Pydantic)
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-11-17  
**–í–µ—Ä—Å–∏—è API:** 0.1.0

