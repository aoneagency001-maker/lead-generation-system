# ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 22.11.2025 00:01

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Backend - –ú–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π

**–§–∞–π–ª:** `library/integrations/yandex_metrika.py`

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥:** `get_recent_visits()`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–µ—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Reporting API
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ dimensions –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –≤–∏–∑–∏—Ç–µ:
  - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–µ—â–µ–Ω–∏—è
  - IP –∞–¥—Ä–µ—Å (–ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ "N/A" —á–µ—Ä–µ–∑ Reporting API, –Ω—É–∂–µ–Ω Logs API –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö IP)
  - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (desktop/mobile/tablet)
  - –ë—Ä–∞—É–∑–µ—Ä –∏ –û–°
  - –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (—Å—Ç—Ä–∞–Ω–∞, –≥–æ—Ä–æ–¥)
  - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
  - –†–µ—Ñ–µ—Ä—Ä–µ—Ä
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
  - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–∑–∏—Ç–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
  - –ù–æ–≤—ã–π/–≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å

**Dimensions –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ:**
- `ym:s:date` - –¥–∞—Ç–∞
- `ym:s:dateTime` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- `ym:s:startURL` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
- `ym:s:referer` - —Ä–µ—Ñ–µ—Ä—Ä–µ—Ä
- `ym:s:deviceCategory` - –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `ym:s:browser` - –±—Ä–∞—É–∑–µ—Ä
- `ym:s:operatingSystem` - –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- `ym:s:regionCountry` - —Å—Ç—Ä–∞–Ω–∞
- `ym:s:regionCity` - –≥–æ—Ä–æ–¥
- `ym:s:isNewUser` - –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**Metrics:**
- `ym:s:visits` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤
- `ym:s:pageviews` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü
- `ym:s:avgVisitDurationSeconds` - —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–∑–∏—Ç–∞

### 2. Backend - API Endpoint

**–§–∞–π–ª:** `core/api/routes/yandex_metrika.py`

**–ù–æ–≤—ã–π endpoint:** `GET /api/yandex-metrika/counters/{counter_id}/recent-visits`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `days` (query, default=7) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –Ω–∞–∑–∞–¥
- `limit` (query, default=50) - –ª–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–º–∞–∫—Å–∏–º—É–º 100)

**–û—Ç–≤–µ—Ç:**
```json
{
  "visits": [
    {
      "date": "2025-11-22",
      "time": "14:30:25",
      "ip_address": "N/A",
      "device": "desktop",
      "browser": "Chrome",
      "os": "Windows",
      "country": "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω",
      "city": "–ê–ª–º–∞—Ç—ã",
      "start_url": "https://example.com/page",
      "referer": "https://google.com",
      "pageviews": 5,
      "duration": 120,
      "is_new_user": true
    }
  ],
  "count": 50,
  "period": {
    "from": "2025-11-15",
    "to": "2025-11-22"
  }
}
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 3. Frontend - API Client

**–§–∞–π–ª:** `frontend/lib/api-client.ts`

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥:** `getMetrikaRecentVisits()`

### 4. Frontend - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç RecentVisits

**–§–∞–π–ª:** `frontend/components/yandex-metrika/RecentVisits.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –ø–æ—Å–µ—â–µ–Ω–∏—è–º–∏
- ‚úÖ –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (3/7/14/30 –¥–Ω–µ–π)
- ‚úÖ –í—ã–±–æ—Ä –ª–∏–º–∏—Ç–∞ (25/50/100)
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–∑–∏—Ç–µ:
  - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)
  - IP –∞–¥—Ä–µ—Å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  - –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (—Å—Ç—Ä–∞–Ω–∞, –≥–æ—Ä–æ–¥) —Å –∏–∫–æ–Ω–∫–æ–π
  - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (desktop/mobile/tablet) —Å –∏–∫–æ–Ω–∫–æ–π
  - –ë—Ä–∞—É–∑–µ—Ä –∏ –û–°
  - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞)
  - –†–µ—Ñ–µ—Ä—Ä–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü (badge)
  - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è: "5–º 30—Å")
  - –¢–∏–ø –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è (–ù–æ–≤—ã–π/–í–æ–∑–≤—Ä–∞—Ç) —Å badge

**UI —ç–ª–µ–º–µ–Ω—Ç—ã:**
- –ò–∫–æ–Ω–∫–∏ –¥–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –≤—Ä–µ–º–µ–Ω–∏
- Badges –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Ç–∏–ø–∞ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è
- –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
- –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–æ–∫

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `frontend/app/(dashboard)/dashboard/analytics/yandex-metrika/page.tsx`

- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—á–µ—Ç—á–∏–∫

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –§–æ—Ä–º–∞—Ç |
|---------|----------|--------|
| –î–∞—Ç–∞/–í—Ä–µ–º—è | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–µ—â–µ–Ω–∏—è | "2025-11-22 14:30:25" |
| –ì–µ–æ–≥—Ä–∞—Ñ–∏—è | –°—Ç—Ä–∞–Ω–∞ –∏ –≥–æ—Ä–æ–¥ | "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω<br>–ê–ª–º–∞—Ç—ã" |
| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –±—Ä–∞—É–∑–µ—Ä, –û–° | "desktop<br>Chrome / Windows" |
| –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ | URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞ | –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ |
| –°—Ç—Ä–∞–Ω–∏—Ü | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü | Badge —Å —á–∏—Å–ª–æ–º |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è –Ω–∞ —Å–∞–π—Ç–µ | "5–º 30—Å" |
| –¢–∏–ø | –ù–æ–≤—ã–π/–í–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è | Badge —Å –∏–∫–æ–Ω–∫–æ–π |

## üé® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ UI

- ‚úÖ –ò–∫–æ–Ω–∫–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (Globe, Monitor, Clock, User)
- ‚úÖ –¶–≤–µ—Ç–Ω—ã–µ badges –¥–ª—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —Å –∏–∫–æ–Ω–∫–æ–π ExternalLink
- ‚úÖ –û–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö URL (40 —Å–∏–º–≤–æ–ª–æ–≤ + "...")
- ‚úÖ Tooltip —Å –ø–æ–ª–Ω—ã–º URL –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
- ‚úÖ Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Å—Ç—Ä–æ–∫–∞—Ö —Ç–∞–±–ª–∏—Ü—ã

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### IP –∞–¥—Ä–µ—Å

**–ü—Ä–æ–±–ª–µ–º–∞:** Reporting API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç IP –∞–¥—Ä–µ—Å–∞ –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "N/A" –¥–ª—è IP –∞–¥—Ä–µ—Å–∞
- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö IP –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Logs API** (–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å)

**–ë—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Logs API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤
- –¢—Ä–µ–±—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ ‚Üí –æ–∂–∏–¥–∞–Ω–∏–µ ‚Üí —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Reporting API —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- –û–¥–∏–Ω –≤–∏–∑–∏—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ä–∞–∑–Ω—ã–µ dimensions)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:**
- Logs API –¥–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–∞–∂–¥–æ–º –≤–∏–∑–∏—Ç–µ
- –ù–æ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–∞—Å—Ç–µ–π)

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:3000/dashboard/analytics/yandex-metrika`
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç—á–∏–∫
3. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–æ —Å–µ–∫—Ü–∏–∏ "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–µ—â–µ–Ω–∏—è"
4. –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ (3/7/14/30 –¥–Ω–µ–π)
5. –í—ã–±–µ—Ä–∏—Ç–µ –ª–∏–º–∏—Ç (25/50/100)
6. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –≤–∏–∑–∏—Ç–µ

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ—Å–µ—â–µ–Ω–∏—è—Ö! üéâ

