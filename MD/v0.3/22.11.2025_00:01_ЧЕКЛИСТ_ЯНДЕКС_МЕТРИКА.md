# –ß–µ–∫–ª–∏—Å—Ç: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–±–æ—Ç–µ —Å –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–æ–π

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 22.11.2025 00:01

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–û—Ç–º–µ—Ç—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã:

### 1. OAuth —Ç–æ–∫–µ–Ω –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω–æ OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ [oauth.yandex.ru](https://oauth.yandex.ru/)
- [ ] –ü–æ–ª—É—á–µ–Ω Client ID: `_________________`
- [ ] –ü–æ–ª—É—á–µ–Ω Client Secret: `_________________`
- [ ] –ü–æ–ª—É—á–µ–Ω OAuth —Ç–æ–∫–µ–Ω: `AQAAAAA...` (–ø–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤: `__________`)
- [ ] –¢–æ–∫–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env` –∫–∞–∫ `YANDEX_METRIKA_TOKEN`

### 2. ID —Å—á–µ—Ç—á–∏–∫–∞ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏
- [ ] –ù–∞–π–¥–µ–Ω ID —Å—á–µ—Ç—á–∏–∫–∞: `__________`
- [ ] ID –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env` –∫–∞–∫ `YANDEX_METRIKA_COUNTER_ID`

### 3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–æ `metrika:read` (—á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–æ `metrika:write` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ü–µ–ª–∏/—Ñ–∏–ª—å—Ç—Ä—ã)

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –§–∞–π–ª `.env` —Å–æ–∑–¥–∞–Ω/–æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã:
  ```bash
  YANDEX_METRIKA_TOKEN=...
  YANDEX_METRIKA_COUNTER_ID=...
  ```
- [ ] `.env` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∑–∞–ø—Ä–æ—Å –∫ Management API (—Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç—á–∏–∫–æ–≤)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∑–∞–ø—Ä–æ—Å –∫ Reporting API (–ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å Logs API (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìù –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞

### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

**Management API:**
```bash
curl -H "Authorization: OAuth –í–ê–®_–¢–û–ö–ï–ù" \
  https://api-metrika.yandex.net/management/v1/counters
```

**Reporting API:**
```bash
curl -H "Authorization: OAuth –í–ê–®_–¢–û–ö–ï–ù" \
  "https://api-metrika.yandex.net/stat/v1/data?ids=ID_–°–ß–ï–¢–ß–ò–ö–ê&metrics=ym:s:visits"
```

**Logs API (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞):**
```bash
curl -X POST \
  -H "Authorization: OAuth –í–ê–®_–¢–û–ö–ï–ù" \
  -H "Content-Type: application/json" \
  -d '{"date1":"2025-11-01","date2":"2025-11-22"}' \
  "https://api-metrika.yandex.net/logs/v1/export/visits?counter_id=ID_–°–ß–ï–¢–ß–ò–ö–ê"
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `.env`

```bash
# –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞
YANDEX_METRIKA_TOKEN=AQAAAAA...–≤–∞—à_—Ç–æ–∫–µ–Ω...
YANDEX_METRIKA_COUNTER_ID=12345678

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞)
YANDEX_METRIKA_CLIENT_ID=–≤–∞—à_client_id
YANDEX_METRIKA_CLIENT_SECRET=–≤–∞—à_client_secret
YANDEX_METRIKA_REFRESH_TOKEN=–≤–∞—à_refresh_token
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

```python
import os
import httpx

async def test_token():
    token = os.getenv("YANDEX_METRIKA_TOKEN")
    if not token:
        print("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env")
        return False
    
    async with httpx.AsyncClient() as client:
        try:
            response = await client.get(
                "https://api-metrika.yandex.net/management/v1/counters",
                headers={"Authorization": f"OAuth {token}"}
            )
            if response.status_code == 200:
                print("‚úÖ –¢–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç!")
                return True
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞: {response.status_code}")
                return False
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
            return False
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ ID —Å—á–µ—Ç—á–∏–∫–∞

```python
import os
import httpx

async def test_counter_id():
    token = os.getenv("YANDEX_METRIKA_TOKEN")
    counter_id = os.getenv("YANDEX_METRIKA_COUNTER_ID")
    
    if not counter_id:
        print("‚ùå ID —Å—á–µ—Ç—á–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env")
        return False
    
    async with httpx.AsyncClient() as client:
        try:
            response = await client.get(
                f"https://api-metrika.yandex.net/management/v1/counter/{counter_id}",
                headers={"Authorization": f"OAuth {token}"}
            )
            if response.status_code == 200:
                print("‚úÖ –°—á–µ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω!")
                print(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {response.json()['counter']['name']}")
                return True
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞: {response.status_code}")
                return False
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
            return False
```

---

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| `401 Unauthorized` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞, –Ω–µ—Ç –ª–∏ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ |
| `403 Forbidden` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `404 Not Found` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ID —Å—á–µ—Ç—á–∏–∫–∞ |
| `429 Too Many Requests` | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (10,000/–¥–µ–Ω—å), –ø–æ–¥–æ–∂–¥–∏—Ç–µ |
| –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ | –û–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ refresh_token –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π |

---

## üìû –°—Å—ã–ª–∫–∏

- [–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](./22.11.2025_00:01_–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–ü–û_–ù–ê–°–¢–†–û–ô–ö–ï_–Ø–ù–î–ï–ö–°_–ú–ï–¢–†–ò–ö–ò.md)
- [OAuth –Ø–Ω–¥–µ–∫—Å](https://oauth.yandex.ru/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API](https://yandex.ru/dev/metrika/)

---

**–ö–æ–≥–¥–∞ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã ‚úÖ - —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç–µ!**

