# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Analytics 4 –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 22.11.2025 00:01

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. Backend - –ö–ª–∏–µ–Ω—Ç Google Analytics 4

**–§–∞–π–ª:** `library/integrations/google_analytics.py`

–°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `GoogleAnalyticsClient` —Å –º–µ—Ç–æ–¥–∞–º–∏:
- ‚úÖ `get_properties()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ Properties (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ `get_report()` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤
- ‚úÖ `get_realtime_report()` - real-time –¥–∞–Ω–Ω—ã–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç)
- ‚úÖ `get_visitors_by_date()` - –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –ø–æ –¥–Ω—è–º
- ‚úÖ `get_traffic_sources()` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- ‚úÖ `get_search_queries()` - –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã/—Å–æ–±—ã—Ç–∏—è
- ‚úÖ `get_geography()` - –≥–µ–æ–≥—Ä–∞—Ñ–∏—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π
- ‚úÖ `get_online_visitors()` - –æ–Ω–ª–∞–π–Ω –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ (real-time)
- ‚úÖ `get_recent_visits()` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–µ—â–µ–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Service Account credentials –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `GOOGLE_ANALYTICS_CREDENTIALS_PATH`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç property_id: "123456789" –∏–ª–∏ "properties/123456789"
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ

### 2. Backend - API Endpoints

**–§–∞–π–ª:** `core/api/routes/google_analytics.py`

–°–æ–∑–¥–∞–Ω—ã endpoints:
- ‚úÖ `GET /api/google-analytics/properties` - —Å–ø–∏—Å–æ–∫ Properties
- ‚úÖ `GET /api/google-analytics/properties/{property_id}/report` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
- ‚úÖ `GET /api/google-analytics/properties/{property_id}/visitors-by-date` - –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –ø–æ –¥–Ω—è–º
- ‚úÖ `GET /api/google-analytics/properties/{property_id}/traffic-sources` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- ‚úÖ `GET /api/google-analytics/properties/{property_id}/search-queries` - –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ `GET /api/google-analytics/properties/{property_id}/geography` - –≥–µ–æ–≥—Ä–∞—Ñ–∏—è
- ‚úÖ `GET /api/google-analytics/properties/{property_id}/online-visitors` - –æ–Ω–ª–∞–π–Ω –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏
- ‚úÖ `GET /api/google-analytics/properties/{property_id}/recent-visits` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–µ—â–µ–Ω–∏—è
- ‚úÖ `GET /api/google-analytics/summary` - –ø–æ–ª–Ω–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ Property

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- Credentials –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- –û—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ message –∏ code
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (401)

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `core/api/config.py`

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚úÖ `google_analytics_credentials_path` - –ø—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É —Å credentials
- ‚úÖ `google_analytics_property_id` - ID Property (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª:** `requirements.txt`

–î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- ‚úÖ `google-analytics-data>=0.18.0` - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK GA4
- ‚úÖ `google-auth>=2.23.0` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google
- ‚úÖ `google-auth-oauthlib>=1.1.0` - OAuth –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–§–∞–π–ª:** `core/api/main.py`

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `google_analytics` router
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω router —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `/api` –∏ —Ç–µ–≥–æ–º "Google Analytics"

**–§–∞–π–ª:** `core/api/routes/__init__.py`

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `google_analytics` –≤ —ç–∫—Å–ø–æ—Ä—Ç—ã

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Service Account

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç–µ **Google Analytics Data API**
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **IAM & Admin ‚Üí Service Accounts**
5. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Service Account
6. –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª—å **"Viewer"** –¥–ª—è Google Analytics
7. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª—é—á (JSON) –∏ —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
# Google Analytics 4
GOOGLE_ANALYTICS_CREDENTIALS_PATH=credentials/ga4-credentials.json
GOOGLE_ANALYTICS_PROPERTY_ID=123456789
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `GOOGLE_ANALYTICS_PROPERTY_ID` –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω, –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ:

```bash
pip install google-analytics-data google-auth google-auth-oauthlib
```

---

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

#### 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ Properties

```bash
curl http://localhost:8001/api/google-analytics/properties
```

#### 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –ø–æ –¥–Ω—è–º

```bash
curl "http://localhost:8001/api/google-analytics/properties/123456789/visitors-by-date?days=30"
```

#### 3. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞

```bash
curl "http://localhost:8001/api/google-analytics/properties/123456789/traffic-sources?days=30&limit=20"
```

#### 4. –ü–æ–ª—É—á–∏—Ç—å –æ–Ω–ª–∞–π–Ω –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π (real-time)

```bash
curl "http://localhost:8001/api/google-analytics/properties/123456789/online-visitors?limit=100"
```

#### 5. –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–∫—É

```bash
curl "http://localhost:8001/api/google-analytics/summary?property_id=123456789&days=7"
```

#### 6. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

```bash
curl "http://localhost:8001/api/google-analytics/properties/123456789/report?metrics=sessions,activeUsers&date1=2025-01-01&date2=2025-01-31&dimensions=country,city&limit=100"
```

---

## üîÑ –û—Ç–ª–∏—á–∏—è –æ—Ç –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ | Google Analytics 4 |
|----------|----------------|---------------------|
| **ID** | `counter_id` (—á–∏—Å–ª–æ) | `property_id` (—Å—Ç—Ä–æ–∫–∞) |
| **–ú–µ—Ç—Ä–∏–∫–∏** | `ym:s:visits`, `ym:s:users` | `sessions`, `activeUsers` |
| **Dimensions** | `ym:s:searchPhrase` | `eventName`, `searchTerm` |
| **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** | OAuth —Ç–æ–∫–µ–Ω | Service Account JSON |

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ GA4

1. **Event-based –º–æ–¥–µ–ª—å** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö
2. **Real-time API** - –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç
3. **BigQuery –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å raw —Å–æ–±—ã—Ç–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. **Measurement Protocol** - server-side tracking (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Admin API** - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö Properties
2. **BigQuery –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è raw —Å–æ–±—ã—Ç–∏–π –±–µ–∑ —Å–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏—è
3. **Measurement Protocol** - –¥–ª—è server-side tracking –∫–æ–Ω–≤–µ—Ä—Å–∏–π
4. **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏
5. **–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è `SearchSegmentationEngine` –¥–ª—è GA4

### Frontend (–±—É–¥—É—â–µ–µ)

–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `PropertySelector.tsx` - –≤—ã–±–æ—Ä Property
- `SummaryView.tsx` - —Å–≤–æ–¥–∫–∞ –ø–æ Property
- `AnalyticsDashboard.tsx` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- `RecentVisits.tsx` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–µ—â–µ–Ω–∏—è

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–°–ø–∏—Å–æ–∫ Properties**: GA4 Data API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ Properties –Ω–∞–ø—Ä—è–º—É—é. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google Analytics Admin API.

2. **–ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –í GA4 –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –ú–µ—Ç—Ä–∏–∫–∏. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è (`eventName`) –∏ landing pages –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.

3. **Rate Limits**: GA4 –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç 600k –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.

4. **Real-time –¥–∞–Ω–Ω—ã–µ**: Real-time API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç.

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**Backend:** ‚úÖ **–ì–û–¢–û–í** (100%)

- ‚úÖ –ö–ª–∏–µ–Ω—Ç GA4 —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ API endpoints —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**Frontend:** ‚è≥ **–í –ü–õ–ê–ù–ê–•**

- ‚è≥ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö GA4
- ‚è≥ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ `/dashboard/analytics/google-analytics`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** ‚úÖ **–ì–û–¢–û–í–ê**

---

**–ê–≤—Ç–æ—Ä:** AI Assistant (Auto)  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 22.11.2025 00:01  
**–í–µ—Ä—Å–∏—è:** 1.0

