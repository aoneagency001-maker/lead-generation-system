# üîó –°—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ–µ–∫—Ç –∏ –ø–ª–∞–Ω –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 03:15

---

## üåê –°—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ–µ–∫—Ç

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

**Backend API:**
- URL: http://localhost:8001
- Swagger UI: http://localhost:8001/docs
- Health Check: http://localhost:8001/api/health
- Data Intake Sources: http://localhost:8001/api/data-intake/sources
- Data Intake Health: http://localhost:8001/api/data-intake/health

**Frontend:**
- URL: http://localhost:3000
- Dashboard: http://localhost:3000/dashboard
- Data Intake: http://localhost:3000/dashboard/analytics/data-intake
- LLM Pipeline: http://localhost:3000/dashboard/analytics/llm-pipeline

### Production (–µ—Å–ª–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ)

**Backend API:**
- URL: http://164.90.160.106:8000 (–∏–∑ docker-compose.prod.yml)
- Health Check: http://164.90.160.106:8000/api/health

**Frontend:**
- URL: http://164.90.160.106:3001 (–∏–∑ docker-compose.prod.yml)

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:

1. **Yandex.Metrika:**
   - ‚úÖ `YANDEX_METRIKA_TOKEN` - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (53 —Å–∏–º–≤–æ–ª–∞)
   - ‚ùå `YANDEX_METRIKA_COUNTER_ID` - **–ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**

2. **Google Analytics 4:**
   - ‚úÖ `GOOGLE_ANALYTICS_CREDENTIALS_PATH` - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (`credentials/ga4-service-account.json`)
   - ‚úÖ –§–∞–π–ª credentials —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - ‚ùå `GOOGLE_ANALYTICS_PROPERTY_ID` - **–ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**

### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
python3 scripts/check_env_variables.py
```

---

## üéØ –ü–ª–∞–Ω –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 1: Yandex.Metrika Counter ID

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–±—ã—Å—Ç—Ä–æ)

1. **–û—Ç–∫—Ä—ã—Ç—å –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É:**
   - –°—Å—ã–ª–∫–∞: https://metrika.yandex.ru/
   - –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç

2. **–ù–∞–π—Ç–∏ Counter ID:**
   - –í—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π —Å—á–µ—Ç—á–∏–∫
   - Counter ID –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ URL: `https://metrika.yandex.ru/dashboard?id=<COUNTER_ID>`
   - –ò–ª–∏: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–¥ —Å—á–µ—Ç—á–∏–∫–∞ ‚Üí —Ç–∞–º –±—É–¥–µ—Ç ID

3. **–î–æ–±–∞–≤–∏—Ç—å –≤ .env:**
   ```bash
   YANDEX_METRIKA_COUNTER_ID=–≤–∞—à_counter_id
   ```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ API (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–∫–µ–Ω)

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç—á–∏–∫–æ–≤:
curl -H "Authorization: OAuth y0__xDRn5OABBir2zsgqO_EnxUezT_ln_UKWnGz2duHNjE8tQQzfA" \
  https://api-metrika.yandex.net/management/v1/counters

# –í –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å –∏—Ö ID
```

**–°—Å—ã–ª–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API:**
- Management API: https://api-metrika.yandex.net/management/v1/counters
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://yandex.ru/dev/metrika/doc/api2/api_v1/intro.html

---

### –®–∞–≥ 2: Google Analytics 4 Property ID

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–±—ã—Å—Ç—Ä–æ)

1. **–û—Ç–∫—Ä—ã—Ç—å Google Analytics:**
   - –°—Å—ã–ª–∫–∞: https://analytics.google.com/
   - –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç

2. **–ù–∞–π—Ç–∏ Property ID:**
   - –í—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π Property
   - –ü–µ—Ä–µ–π—Ç–∏: Admin ‚Üí Property Settings
   - Property ID –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ "Property Details"
   - –§–æ—Ä–º–∞—Ç: `123456789` (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)

3. **–î–æ–±–∞–≤–∏—Ç—å –≤ .env:**
   ```bash
   GOOGLE_ANALYTICS_PROPERTY_ID=–≤–∞—à_property_id
   ```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ API (–µ—Å–ª–∏ credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Admin API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ Properties
# (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Service Account)
```

**–°—Å—ã–ª–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- Google Analytics: https://analytics.google.com/
- Google Cloud Console: https://console.cloud.google.com/
- Admin API: https://developers.google.com/analytics/devguides/config/admin/v1

---

## üîß –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–∏—Ç—å Counter ID –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏

**–°—Å—ã–ª–∫–∞:** https://metrika.yandex.ru/

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
2. –í—ã–±—Ä–∞—Ç—å —Å—á–µ—Ç—á–∏–∫
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID –∏–∑ URL –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
4. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
   ```bash
   YANDEX_METRIKA_COUNTER_ID=–≤–∞—à_id
   ```

### 2. –ü–æ–ª—É—á–∏—Ç—å Property ID –¥–ª—è GA4

**–°—Å—ã–ª–∫–∞:** https://analytics.google.com/

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
2. –í—ã–±—Ä–∞—Ç—å Property
3. Admin ‚Üí Property Settings
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Property ID
5. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
   ```bash
   GOOGLE_ANALYTICS_PROPERTY_ID=–≤–∞—à_id
   ```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
./scripts/stop.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
./scripts/start.sh
# –∏–ª–∏
uvicorn core.api.main:app --reload --host 0.0.0.0 --port 8001
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
python3 scripts/check_env_variables.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health:
curl http://localhost:8001/api/data-intake/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
curl http://localhost:8001/api/data-intake/sources
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### Yandex.Metrika

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞:**
```bash
curl -H "Authorization: OAuth y0__xDRn5OABBir2zsgqO_EnxUezT_ln_UKWnGz2duHNjE8tQQzfA" \
  https://api-metrika.yandex.net/management/v1/counters
```

**–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π:**
- –í–µ—Ä–Ω–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç—á–∏–∫–æ–≤
- –ú–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å Counter ID –∏–∑ –æ—Ç–≤–µ—Ç–∞

**–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π:**
- –û—à–∏–±–∫–∞ 401 –∏–ª–∏ 403
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ OAuth

**–°—Å—ã–ª–∫–∏:**
- OAuth: https://oauth.yandex.ru/
- API Docs: https://yandex.ru/dev/metrika/doc/api2/api_v1/intro.html

### Google Analytics 4

**–ü—Ä–æ–≤–µ—Ä–∫–∞ credentials:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
ls -la credentials/ga4-service-account.json

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –≤–∞–ª–∏–¥–Ω—ã–π JSON:
python3 -c "import json; json.load(open('credentials/ga4-service-account.json'))"
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞:**
- –ï—Å–ª–∏ Service Account –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ Property ‚Üí –æ—à–∏–±–∫–∞ 403
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Service Account email –≤ GA4 Property Access Management

**–°—Å—ã–ª–∫–∏:**
- GA4 Admin: https://analytics.google.com/
- Google Cloud: https://console.cloud.google.com/
- Service Accounts: https://console.cloud.google.com/iam-admin/serviceaccounts

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –ü–æ–ª—É—á–µ–Ω YANDEX_METRIKA_COUNTER_ID
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –≤ .env
- [ ] –ü–æ–ª—É—á–µ–Ω GOOGLE_ANALYTICS_PROPERTY_ID
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –≤ .env
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω backend
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω health endpoint
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∑–∞–ø—É—Å–∫ pipeline

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### Yandex.Metrika
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** https://metrika.yandex.ru/
- **OAuth:** https://oauth.yandex.ru/
- **API Docs:** https://yandex.ru/dev/metrika/doc/api2/api_v1/intro.html
- **Management API:** https://api-metrika.yandex.net/management/v1/counters

### Google Analytics 4
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** https://analytics.google.com/
- **Google Cloud:** https://console.cloud.google.com/
- **Service Accounts:** https://console.cloud.google.com/iam-admin/serviceaccounts
- **Data API:** https://developers.google.com/analytics/devguides/reporting/data/v1
- **Admin API:** https://developers.google.com/analytics/devguides/config/admin/v1

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **–ü–ª–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:** `MD/v0.3/23.11.2025_03:00_–ü–õ–ê–ù_–ù–ê–°–¢–†–û–ô–ö–ò_–¢–ï–°–¢–û–í–´–•_–î–ê–ù–ù–´–•_–ê–í–¢–û–†–ò–ó–ê–¶–ò–ò.md`
- **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ú–µ—Ç—Ä–∏–∫–∏:** `MD/v0.3/22.11.2025_00:01_–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–ü–û_–ù–ê–°–¢–†–û–ô–ö–ï_–Ø–ù–î–ï–ö–°_–ú–ï–¢–†–ò–ö–ò.md`
- **–û—Ç—á–µ—Ç GA4:** `MD/v0.3/22.11.2025_18:05_–û–¢–ß–ï–¢_–û_–ì–û–¢–û–í–ù–û–°–¢–ò_–ú–û–î–£–õ–Ø_GA4.md`

---

## ‚ö†Ô∏è –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: "Provider not available"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `python3 scripts/check_env_variables.py`
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.env`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "Authentication failed"

**–î–ª—è Yandex.Metrika:**
- –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ OAuth
- –¢–æ–∫–µ–Ω –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å scope –≤ OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**–î–ª—è Google Analytics:**
- Service Account –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ GA4 Property Access Management
- Credentials —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å Service Account key

### –ü—Ä–æ–±–ª–µ–º–∞: "Counter ID not found" –∏–ª–∏ "Property ID not found"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É —Ç–æ–∫–µ–Ω–∞/credentials –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —Å—á–µ—Ç—á–∏–∫—É/property

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 03:15

