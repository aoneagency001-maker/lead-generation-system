# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Yandex API –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 03:45

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ datetime
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_serialize_for_json()` –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –í—Å–µ datetime –æ–±—ä–µ–∫—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ ISO-—Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞: "Object of type datetime is not JSON serializable"

### 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è GOOGLE_ANALYTICS
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_normalize_generic()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö GA4
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã `_parse_datetime()` –∏ `_parse_traffic_type()`
- ‚úÖ –¢–µ–ø–µ—Ä—å pipeline –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ GA4 (L2 > 0)

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Yandex API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (401, 403, timeout, request errors)
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ API
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ dimensions (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)

### 4. –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏ UI
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º —ç—Ç–∞–ø–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ pipeline
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å Features" —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `YANDEX_METRIKA_COUNTER_ID=94052393`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `GOOGLE_ANALYTICS_PROPERTY_ID=439601417`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `yandex_metrika_counter_id` –≤ Settings
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `extra = "ignore"` –≤ Pydantic Config

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ Yandex API

**–¢–µ—Å—Ç API:**
```bash
Status: 200
‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞: ['query', 'data', 'total_rows', ...]
–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏: {'dimensions': [{'name': '2025-11-16'}], 'metrics': [145.0]}
```

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
- Dimensions: `[{"name": "value"}]` - –æ–±—ä–µ–∫—Ç—ã —Å –ø–æ–ª–µ–º "name"
- –ú–µ—Ç—Ä–∏–∫–∏: `[145.0]` - –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ü–∞—Ä—Å–∏–Ω–≥ dimensions –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### Backend
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8001
- ‚úÖ –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã: YANDEX_METRIKA, GOOGLE_ANALYTICS
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### Pipeline
- ‚úÖ –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è datetime –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è GA4 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è Yandex —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞

### Frontend
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å Features" –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å pipeline:**
   - –í—ã–±—Ä–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ (YANDEX_METRIKA –∏–ª–∏ GOOGLE_ANALYTICS)
   - –£–∫–∞–∑–∞—Ç—å –¥–∞—Ç—ã
   - –ù–∞–∂–∞—Ç—å "–ó–∞–ø—É—Å—Ç–∏—Ç—å"
   - –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è L1, L2, L3 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å > 0
   - –ï—Å–ª–∏ L2 = 0, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ï—Å–ª–∏ L3 = 0, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

3. **–ó–∞–≥—Ä—É–∑–∏—Ç—å Features:**
   - –ù–∞–∂–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å Features"
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ª–æ–≥–æ–≤
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –±—É–¥–µ—Ç alert —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ pipeline –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend:**
   ```bash
   tail -f server.log | grep -E "Yandex|Google|pipeline|error"
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   ```bash
   python3 scripts/check_env_variables.py
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –Ω–∞–ø—Ä—è–º—É—é:**
   ```bash
   curl http://localhost:8001/api/data-intake/health
   curl http://localhost:8001/api/data-intake/sources
   ```

### –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å Features" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫ API

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 03:45

