# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 05:10  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

```
Error response from daemon: Conflict. The container name "/leadgen-metabase" is already in use by container "...". 
You have to remove (or rename) that container to be able to reuse that name.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `--remove-orphans`

**–ë—ã–ª–æ:**
```bash
docker-compose down || true
docker-compose up -d --build || true
```

**–°—Ç–∞–ª–æ:**
```bash
docker-compose down --remove-orphans || true
docker-compose up -d --build --remove-orphans || true
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `--remove-orphans`:**
- –£–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Ç–µ–∫—É—â–µ–º docker-compose.yml
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º—ë–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –û—á–∏—â–∞–µ—Ç "–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏–µ" –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

### 2. –£–±—Ä–∞–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `version` –∏–∑ docker-compose.yml

**–ë—ã–ª–æ:**
```yaml
version: '3.8'

services:
  ...
```

**–°—Ç–∞–ª–æ:**
```yaml
services:
  ...
```

**–ü–æ—á–µ–º—É:**
- –í –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Docker Compose –∞—Ç—Ä–∏–±—É—Ç `version` —É—Å—Ç–∞—Ä–µ–ª
- Docker Compose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–µ—Ä—Å–∏—é —Ñ–æ—Ä–º–∞—Ç–∞
- –£–±–∏—Ä–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: `the attribute 'version' is obsolete`

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

```bash
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker-compose down --remove-orphans || true
echo "üöÄ –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker-compose up -d --build --remove-orphans || true
```

---

## üìã –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### Workflow (.github/workflows/auto-deploy.yml)

```yaml
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
if [ -f docker-compose.yml ]; then
  if docker ps >/dev/null 2>&1; then
    echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    docker-compose down --remove-orphans || true
    echo "üöÄ –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    docker-compose up -d --build --remove-orphans || true
  elif sudo docker ps >/dev/null 2>&1; then
    echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    sudo docker-compose down --remove-orphans || true
    echo "üöÄ –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
    sudo docker-compose up -d --build --remove-orphans || true
  fi
fi
```

### docker-compose.yml

```yaml
# –£–±—Ä–∞–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π version: '3.8'
services:
  redis:
    ...
  n8n:
    ...
  metabase:
    ...
```

---

## üß™ –¢–µ—Å—Ç

–¢–µ–ø–µ—Ä—å workflow –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å:

1. –û—Ç–∫—Ä–æ–π: https://github.com/aoneagency001-maker/lead-generation-system/actions
2. –ó–∞–ø—É—Å—Ç–∏ workflow: **"Run workflow"** ‚Üí **"Run workflow"**
3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
   - ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
   - ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å—Å—è –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - ‚úÖ –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ `version`

---

## üìã –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é:

```bash
ssh ec2-user@13.220.11.94
cd /home/ec2-user/lead-generation-system

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps -a

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down --remove-orphans

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up -d --build --remove-orphans

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker ps
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

- [x] –î–æ–±–∞–≤–ª–µ–Ω `--remove-orphans` –¥–ª—è –≤—Å–µ—Ö docker-compose –∫–æ–º–∞–Ω–¥
- [x] –£–±—Ä–∞–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `version` –∏–∑ docker-compose.yml
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ workflow
- [ ] Workflow –∑–∞–ø—É—â–µ–Ω –∏ –ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 05:10  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!**

