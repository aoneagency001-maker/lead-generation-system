# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Data Intake Pipeline

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 02:45

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã

### 1. –í —Å–ø–∏—Å–∫–µ —Ç–æ–ª—å–∫–æ YANDEX_METRIKA
**–ü—Ä–∏—á–∏–Ω–∞:** Google Analytics –ø—Ä–æ–≤–∞–π–¥–µ—Ä –±—ã–ª –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ `data_intake/pipeline.py`

### 2. –û—à–∏–±–∫–∞ "Provider not available for YANDEX_METRIKA"
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω Google Analytics –ø—Ä–æ–≤–∞–π–¥–µ—Ä

**–§–∞–π–ª:** `data_intake/pipeline.py`

**–ë—ã–ª–æ:**
```python
# Future providers:
# try:
#     ga = GoogleAnalyticsProvider()
#     self.providers[SourceType.GOOGLE_ANALYTICS] = ga
# except Exception:
#     pass
```

**–°—Ç–∞–ª–æ:**
```python
# Register Google Analytics 4
try:
    ga = GoogleAnalyticsProvider()
    self.providers[SourceType.GOOGLE_ANALYTICS] = ga
    logger.info("‚úÖ Registered Google Analytics 4 provider")
except Exception as e:
    logger.warning(f"‚ö†Ô∏è Google Analytics provider not available: {e}")
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint `/sources`

**–§–∞–π–ª:** `data_intake/routes.py`

**–ë—ã–ª–æ:**
```python
service = get_data_intake_service()
sources = service.get_registered_sources()
```

**–°—Ç–∞–ª–æ:**
```python
# Use pipeline to get registered providers
pipeline = get_pipeline()
sources = list(pipeline.providers.keys())
```

–¢–µ–ø–µ—Ä—å endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–∑ pipeline, –≥–¥–µ –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è.

### 3. –£–ª—É—á—à–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

**–§–∞–π–ª:** `data_intake/pipeline.py`

**–ë—ã–ª–æ:**
```python
raise PipelineError(f"Provider not available for {source.value}")
```

**–°—Ç–∞–ª–æ:**
```python
available = [s.value for s in self.providers.keys()]
raise PipelineError(
    f"Provider not available for {source.value}. "
    f"Available providers: {', '.join(available) if available else 'none'}. "
    f"Check environment variables: "
    f"YANDEX_METRIKA_TOKEN/COUNTER_ID for Metrika, "
    f"GOOGLE_ANALYTICS_CREDENTIALS_PATH/PROPERTY_ID for GA4"
)
```

### 4. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ API

**–§–∞–π–ª:** `data_intake/routes.py`

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `PipelineError` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.

## üîç –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –î–ª—è Yandex.Metrika:
```bash
# –í .env –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
YANDEX_METRIKA_TOKEN=your_token
YANDEX_METRIKA_COUNTER_ID=your_counter_id
```

### –î–ª—è Google Analytics 4:
```bash
# –í .env –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
GOOGLE_ANALYTICS_CREDENTIALS_PATH=credentials/ga4-service-account.json
GOOGLE_ANALYTICS_PROPERTY_ID=your_property_id
```

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å:
- ‚úÖ –í —Å–ø–∏—Å–∫–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Metrika –∏ GA4, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)
- ‚úÖ –û—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- ‚úÖ –ï—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω—É–∂–Ω—ã

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:**
   ```bash
   curl http://localhost:8001/api/data-intake/sources
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health:**
   ```bash
   curl http://localhost:8001/api/data-intake/health
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   # –í .env —Ñ–∞–π–ª–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã
   ```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.11.2025 02:45

