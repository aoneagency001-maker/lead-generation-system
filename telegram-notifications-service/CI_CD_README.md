# üöÄ CI/CD Pipeline Documentation

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 21.11.2025 05:30

---

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø–æ–ª–Ω—ã–º CI/CD pipeline –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ AWS Lambda.

---

## üîÑ Workflows

### 1. **Test & Lint** (`.github/workflows/test.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Pull Request –≤ `main`
- Push –≤ `main` (—Ç–æ–ª—å–∫–æ –¥–ª—è telegram-notifications-service)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç TypeScript
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –ª–∏–Ω—Ç–µ—Ä (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Å–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞

---

### 2. **Deploy to AWS Lambda** (`.github/workflows/deploy.yml`)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main` (—Ç–æ–ª—å–∫–æ –¥–ª—è telegram-notifications-service)
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub Actions UI

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Node.js –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç TypeScript –ø—Ä–æ–µ–∫—Ç
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ AWS SSM Parameter Store
- ‚úÖ –î–µ–ø–ª–æ–∏—Ç –Ω–∞ AWS Lambda —á–µ—Ä–µ–∑ Serverless Framework
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç endpoints –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- ‚úÖ –í—ã–≤–æ–¥–∏—Ç summary —Å endpoint URL

---

## üîê –¢—Ä–µ–±—É–µ–º—ã–µ GitHub Secrets

–î–ª—è —Ä–∞–±–æ—Ç—ã CI/CD pipeline –Ω—É–∂–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ secrets:

### AWS Credentials

```
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key

‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ Git!
```

**–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://github.com/{owner}/{repo}/settings/secrets/actions`
2. –ù–∞–∂–º–∏—Ç–µ "New repository secret"
3. –î–æ–±–∞–≤—å—Ç–µ –æ–±–∞ —Å–µ–∫—Ä–µ—Ç–∞

**–í–∞–∂–Ω–æ:** –≠—Ç–∏ —Å–µ–∫—Ä–µ—Ç—ã —É–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ AWS SSM –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Lambda.

---

## üöÄ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ–ø–ª–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

1. **Push –≤ main** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow
2. **–°–±–æ—Ä–∫–∞** ‚Üí TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
3. **–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤** ‚Üí –∏–∑ AWS SSM Parameter Store
4. **–î–µ–ø–ª–æ–π** ‚Üí —á–µ—Ä–µ–∑ Serverless Framework
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ `/health` endpoint
6. **Summary** ‚Üí –≤—ã–≤–æ–¥ endpoint URL –≤ GitHub Actions

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://github.com/{owner}/{repo}/actions`
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow "üöÄ Deploy to AWS Lambda"
3. –ù–∞–∂–º–∏—Ç–µ "Run workflow"
4. –í—ã–±–µ—Ä–∏—Ç–µ stage (`dev` –∏–ª–∏ `prod`)
5. –ù–∞–∂–º–∏—Ç–µ "Run workflow"

---

## üìä –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### Health Check

```bash
curl https://{endpoint}/health
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "status": "ok",
  "service": "telegram-notifications-service",
  "version": "2.0.0",
  "checks": {
    "dynamodb": true,
    "telegram": true
  }
}
```

### Track Visitor (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
curl -X POST https://{endpoint}/track-visitor \
  -H "Content-Type: application/json" \
  -d '{"clientId":"test","page":"/test"}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "tracked": true,
  "visitorId": "...",
  "requestId": "..."
}
```

---

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
cd telegram-notifications-service

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–±–æ—Ä–∫–∞
npm run build

# –õ–∏–Ω—Ç–∏–Ω–≥ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
npm run lint

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Å–æ–±—Ä–∞–ª–æ—Å—å
ls -la dist/handlers/
```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ SSM
./scripts/deploy-with-env.sh dev
```

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflows

```
.github/workflows/
‚îú‚îÄ‚îÄ test.yml      # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–∏–Ω–≥
‚îî‚îÄ‚îÄ deploy.yml    # –î–µ–ø–ª–æ–π –Ω–∞ AWS Lambda
```

---

## üêõ Troubleshooting

### –î–µ–ø–ª–æ–π –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã –≤ `telegram-notifications-service/`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –ø—É—à–∏—Ç–µ –≤ `main` –≤–µ—Ç–∫—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ workflow —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: `.github/workflows/deploy.yml`

---

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ SSM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** `Parameter not found`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ AWS SSM:
   ```bash
   aws ssm get-parameter --name "/telegram-notifications/BOT_TOKEN" --with-decryption
   aws ssm get-parameter --name "/telegram-notifications/CHAT_ID"
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ AWS credentials –≤ GitHub Secrets
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏–æ–Ω (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `eu-central-1`)

---

### Endpoint –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã –Ω–µ –º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ endpoint

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CloudFormation stack:
   ```bash
   aws cloudformation describe-stacks --stack-name telegram-notifications-service-dev
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API Gateway –≤ AWS Console
3. Endpoint –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ª–æ–≥–∞—Ö –¥–µ–ø–ª–æ—è

---

### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CloudWatch Logs –¥–ª—è Lambda —Ñ—É–Ω–∫—Ü–∏–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ DynamoDB —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IAM –ø—Ä–∞–≤–∞ Lambda —Ñ—É–Ω–∫—Ü–∏–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **README.md** - –æ–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **DEPLOYMENT.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
- **DEPLOYMENT_SUCCESS.md** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ–ø–ª–æ—è
- **QUICK_START.md** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –¥–µ–ø–ª–æ–µ–º

- [ ] GitHub Secrets –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY)
- [ ] AWS SSM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–∑–¥–∞–Ω—ã (BOT_TOKEN, CHAT_ID)
- [ ] DynamoDB —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ (–∏–ª–∏ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (`npm run build`)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π —Ä–∞–±–æ—Ç–∞–µ—Ç (`./scripts/deploy-with-env.sh dev`)

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ secrets, –∫–∞–∂–¥—ã–π push –≤ `main` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ AWS Lambda.

