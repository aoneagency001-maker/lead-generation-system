# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Telegram Notifications Service

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 21.11.2025  
**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–°—Ç–∞—Ç—É—Å:** Production Ready

---

## üìä –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

Telegram Notifications Service - —ç—Ç–æ serverless –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ AWS Lambda, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è:

1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π** —Å–∞–π—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤
2. **–û–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫** —Å –ª–µ–Ω–¥–∏–Ω–≥–æ–≤ (Tilda, –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–æ—Ä–º—ã)
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π** (–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞)
4. **–û—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –≤ Telegram

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- **Serverless-first** - –ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **Event-driven** - –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ DynamoDB
- **Multi-tenant** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ `clientId`
- **Resilient** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- **Observable** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CloudWatch

---

## üèõ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è                     ‚îÇ
‚îÇ  (–°–∞–π—Ç—ã, –ª–µ–Ω–¥–∏–Ω–≥–∏, –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚îÇ HTTP/HTTPS
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  AWS API Gateway                             ‚îÇ
‚îÇ  ‚Ä¢ Rate limiting                                             ‚îÇ
‚îÇ  ‚Ä¢ CORS                                                      ‚îÇ
‚îÇ  ‚Ä¢ Request validation                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ              ‚îÇ              ‚îÇ
        ‚ñº              ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Lambda     ‚îÇ ‚îÇ   Lambda     ‚îÇ ‚îÇ   Lambda     ‚îÇ
‚îÇ track-visitor‚îÇ ‚îÇtilda-webhook ‚îÇ ‚îÇmetrika-webhook‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                ‚îÇ                ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                ‚îÇ
        ‚ñº                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DynamoDB    ‚îÇ  ‚îÇ  Telegram API  ‚îÇ
‚îÇ  (Events)    ‚îÇ  ‚îÇ  (Notifications)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CloudWatch    ‚îÇ
‚îÇ  (Logs)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. API Gateway

**–†–æ–ª—å:** HTTP –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–∏—ë–º HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ Lambda —Ñ—É–Ω–∫—Ü–∏—è–º
- CORS –æ–±—Ä–∞–±–æ—Ç–∫–∞
- Rate limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Endpoints:**
- `POST /track-visitor` ‚Üí `trackVisitor` Lambda
- `POST /tilda-webhook` ‚Üí `tildaWebhook` Lambda
- `POST /metrika-webhook` ‚Üí `metrikaWebhook` Lambda
- `GET /health` ‚Üí `health` Lambda

### 2. Lambda Functions

#### 2.1. track-visitor Handler

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤–∏–∑–∏—Ç–æ–≤

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. –ü—Ä–∏—ë–º payload –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
2. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–æ—Ç–∞
4. –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
5. –°–æ–∑–¥–∞–Ω–∏–µ `VisitEvent`
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ DynamoDB
7. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- –£–º–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –≤–∏–∑–∏—Ç–æ–≤/–∫–æ–Ω–≤–µ—Ä—Å–∏–π)

#### 2.2. tilda-webhook Handler

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ —Å Tilda

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. –ü—Ä–∏—ë–º webhook –æ—Ç Tilda
2. –í–∞–ª–∏–¥–∞—Ü–∏—è payload
3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–æ—Ä–º—ã (contact/callback/quiz)
4. –°–æ–∑–¥–∞–Ω–∏–µ `FormEvent`
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ DynamoDB
6. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–æ—Ä–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–≤–∏–∑–æ–≤ —Å –æ—Ç–≤–µ—Ç–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–æ—Ä–º—ã

#### 2.3. metrika-webhook Handler

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–æ–π

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. –ü—Ä–∏—ë–º —Å–æ–±—ã—Ç–∏—è –∏–∑ –ú–µ—Ç—Ä–∏–∫–∏
2. –°–æ–∑–¥–∞–Ω–∏–µ `MetrikaEvent`
3. –ü–æ–ø—ã—Ç–∫–∞ —Å–≤—è–∑–∞—Ç—å —Å –≤–∏–∑–∏—Ç–æ–º –∏–∑ –ë–î (enrichment)
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ DynamoDB
5. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–∞—à–µ–π –ë–î
- –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –ú–µ—Ç—Ä–∏–∫–∏ —Å –≤–∏–∑–∏—Ç–∞–º–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### 2.4. health Handler

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Health check –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- –ù–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å DynamoDB
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram

### 3. DynamoDB

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**

| –ê—Ç—Ä–∏–±—É—Ç | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| `pk` | String | Partition key = `clientId` |
| `sk` | String | Sort key = `type#timestamp#id` |
| `type` | String | –¢–∏–ø —Å–æ–±—ã—Ç–∏—è (VISIT/FORM/METRIKA) |
| `id` | String | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–±—ã—Ç–∏—è |
| `clientId` | String | ID –∫–ª–∏–µ–Ω—Ç–∞ |
| `timestamp` | String | ISO 8601 timestamp |
| `source` | String | –ò—Å—Ç–æ—á–Ω–∏–∫ (tracker/tilda/metrika) |
| `payload` | JSON | –ü–æ–ª–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ |
| `ttl` | Number | TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ (90 –¥–Ω–µ–π) |

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- Pay-per-request pricing
- TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ clientId

**–ó–∞–ø—Ä–æ—Å—ã:**
- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–µ–Ω—Ç–∞: `pk = clientId`
- –ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –ø–æ —Ç–∏–ø—É: `pk = clientId AND begins_with(sk, 'VISIT#')`
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é timestamp (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)

### 4. Telegram Bot API

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π:**
- HTML —Ä–∞–∑–º–µ—Ç–∫–∞
- –≠–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –õ–∏–º–∏—Ç 4096 —Å–∏–º–≤–æ–ª–æ–≤

**–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
- –í–∏–∑–∏—Ç—ã (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏–ª–∏ —Å –∫–æ–Ω–≤–µ—Ä—Å–∏—è–º–∏)
- –ó–∞—è–≤–∫–∏ (–≤—Å–µ–≥–¥–∞)
- –°–æ–±—ã—Ç–∏—è –ú–µ—Ç—Ä–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 5. CloudWatch

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ Lambda —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç –≤ CloudWatch
- –ü—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: `[TRACK-VISITOR]`, `[TILDA-WEBHOOK]`, etc.
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –ú–µ—Ç—Ä–∏–∫–∏ Lambda (invocations, errors, duration)
- –ú–µ—Ç—Ä–∏–∫–∏ DynamoDB (read/write units)
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏

---

## üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Ç–æ–∫ 1: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–∞

```
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /track-visitor
   ‚Üì
2. API Gateway ‚Üí Lambda track-visitor
   ‚Üì
3. –í–∞–ª–∏–¥–∞—Ü–∏—è payload
   ‚Üì
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–æ—Ç–∞ ‚Üí –µ—Å–ª–∏ –±–æ—Ç, –≤–æ–∑–≤—Ä–∞—Ç 200 (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º)
   ‚Üì
5. –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (ip-api.com)
   ‚Üì
6. –°–æ–∑–¥–∞–Ω–∏–µ VisitEvent
   ‚Üì
7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ DynamoDB (async)
   ‚Üì
8. –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–æ–≤—ã–π –≤–∏–∑–∏—Ç –∏–ª–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏—è?
   ‚Üì
9. –ï—Å–ª–∏ –¥–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   ‚Üì
10. –í–æ–∑–≤—Ä–∞—Ç 200 —Å visitorId
```

### –ü–æ—Ç–æ–∫ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–∫–∏ —Å Tilda

```
1. Tilda –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /tilda-webhook
   ‚Üì
2. API Gateway ‚Üí Lambda tilda-webhook
   ‚Üì
3. –í–∞–ª–∏–¥–∞—Ü–∏—è payload (phone –∏–ª–∏ email –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)
   ‚Üì
4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–æ—Ä–º—ã
   ‚Üì
5. –°–æ–∑–¥–∞–Ω–∏–µ FormEvent
   ‚Üì
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ DynamoDB (async)
   ‚Üì
7. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   ‚Üì
8. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   ‚Üì
9. –í–æ–∑–≤—Ä–∞—Ç 200
```

### –ü–æ—Ç–æ–∫ 3: –°–æ–±—ã—Ç–∏–µ –∏–∑ –ú–µ—Ç—Ä–∏–∫–∏

```
1. –ú–µ—Ç—Ä–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /metrika-webhook
   ‚Üì
2. API Gateway ‚Üí Lambda metrika-webhook
   ‚Üì
3. –°–æ–∑–¥–∞–Ω–∏–µ MetrikaEvent
   ‚Üì
4. –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π –≤–∏–∑–∏—Ç (–ø–æ sessionId)
   ‚Üì
5. –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (enrichment)
   ‚Üì
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ DynamoDB
   ‚Üì
7. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   ‚Üì
8. –í–æ–∑–≤—Ä–∞—Ç 200
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ IP –∞–¥—Ä–µ—Å–æ–≤

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–æ—Ç–æ–≤ –ø–æ User-Agent
- –ü—Ä–æ–ø—É—Å–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –±–æ—Ç–æ–≤
- –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

### 3. –°–µ–∫—Ä–µ—Ç—ã

- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ AWS Systems Manager Parameter Store
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SecureString –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- –ù–µ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ

### 4. IAM —Ä–æ–ª–∏

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è Lambda
- –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Å DynamoDB
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥—Ä—É–≥–∏–º —Ä–µ—Å—É—Ä—Å–∞–º

---

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

- **Lambda:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ 1000 concurrent executions
- **DynamoDB:** Pay-per-request, –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
- **API Gateway:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞ Lambda)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç)
- TTL –≤ DynamoDB –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

### –õ–∏–º–∏—Ç—ã

- Lambda timeout: 30 —Å–µ–∫—É–Ω–¥
- Lambda memory: 256 MB
- Telegram API: 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É –Ω–∞ –±–æ—Ç–∞
- ip-api.com: 45 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω)

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### CloudWatch Logs

**–ì—Ä—É–ø–ø—ã –ª–æ–≥–æ–≤:**
- `/aws/lambda/telegram-notifications-service-{stage}-trackVisitor`
- `/aws/lambda/telegram-notifications-service-{stage}-tildaWebhook`
- `/aws/lambda/telegram-notifications-service-{stage}-metrikaWebhook`

**–ü—Ä–µ—Ñ–∏–∫—Å—ã:**
- `[TRACK-VISITOR]` - —Å–æ–±—ã—Ç–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- `[TILDA-WEBHOOK]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ Tilda
- `[METRIKA-WEBHOOK]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ú–µ—Ç—Ä–∏–∫–∏
- `[TELEGRAM]` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `[STORAGE]` - —Ä–∞–±–æ—Ç–∞ —Å DynamoDB
- `[GEO-LOCATION]` - –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è

### –ú–µ—Ç—Ä–∏–∫–∏

**Lambda:**
- Invocations
- Errors
- Duration
- Throttles

**DynamoDB:**
- Read/Write capacity
- Throttles
- Errors

### –ê–ª–µ—Ä—Ç—ã

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ CloudWatch Alarms:
- Error rate > 5%
- Duration > 10 seconds
- Throttles > 0

---

## üöÄ –î–µ–ø–ª–æ–π –∏ CI/CD

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

```bash
serverless deploy --stage dev
serverless deploy --stage prod
```

### CI/CD (GitHub Actions)

–ü—Ä–∏–º–µ—Ä workflow:

```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm install
      - run: npm run build
      - run: npm install -g serverless
      - run: serverless deploy --stage prod
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
```

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **SQS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
2. **Redis –∫—ç—à** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
3. **RDS/Postgres** - –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. **GraphQL API** - –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ–±—ã—Ç–∏–π
5. **Real-time dashboard** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
6. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
7. **Machine Learning** - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–π

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [API.md](./API.md) - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ API
- [README.md](../README.md) - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

