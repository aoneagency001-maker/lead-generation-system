# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –¥–µ–ø–ª–æ—é

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞** —á–µ—Ä–µ–∑ GitHub Actions
- **–î–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ main** –≤–µ—Ç–∫—É
- **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏ VPS
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∂–¥–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–µ–≥

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions

### 1. –î–æ–±–∞–≤—å—Ç–µ Secrets –≤ GitHub

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `Settings ‚Üí Secrets and variables ‚Üí Actions`

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ secrets:

```
VPS_HOST=your-vps-ip-or-domain.com
VPS_USER=root
VPS_SSH_KEY=-----BEGIN OPENSSH PRIVATE KEY-----
...
-----END OPENSSH PRIVATE KEY-----
VPS_DEPLOY_PATH=/opt/lead-generation-system
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–∞ –¥–ª—è VPS

**–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:**

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_actions_deploy

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ VPS
ssh-copy-id -i ~/.ssh/github_actions_deploy.pub root@your-vps-ip

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ GitHub Secrets
cat ~/.ssh/github_actions_deploy
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –≤—ã–≤–æ–¥ (–≤–∫–ª—é—á–∞—è BEGIN/END) –≤ VPS_SSH_KEY secret
```

**–ù–∞ VPS:**

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã
sudo visudo
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
# your-user ALL=(ALL) NOPASSWD: /usr/bin/docker, /usr/bin/docker-compose, /usr/bin/systemctl
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPS

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```bash
sudo mkdir -p /opt/lead-generation-system
sudo mkdir -p /opt/backups/leadgen
sudo chown -R $USER:$USER /opt/lead-generation-system
sudo chown -R $USER:$USER /opt/backups
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env –Ω–∞ VPS

```bash
cd /opt/lead-generation-system
nano .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–∞–∫–∂–µ –∫–∞–∫ .env.backup –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
cp .env .env.backup
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/leadgen-api.service`:

```ini
[Unit]
Description=Lead Generation System API
After=docker.service
Requires=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/lead-generation-system
ExecStart=/usr/bin/docker-compose -f docker-compose.prod.yml up -d
ExecStop=/usr/bin/docker-compose -f docker-compose.prod.yml down
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

–ê–∫—Ç–∏–≤–∞—Ü–∏—è:

```bash
sudo systemctl daemon-reload
sudo systemctl enable leadgen-api
sudo systemctl start leadgen-api
```

---

## üì¶ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- **–ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–ø–ª–æ–µ–º** (—á–µ—Ä–µ–∑ GitHub Actions)
- **–ü—Ä–∏ —Ä—É—á–Ω–æ–º –¥–µ–ø–ª–æ–µ** (—á–µ—Ä–µ–∑ `scripts/deploy.sh`)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤:** `~/leadgen-backups/`

**–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏:** `leadgen-backup-YYYYMMDD-HHMMSS.tar.gz`

**–•—Ä–∞–Ω–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞

```bash
cd /Users/vbut/lead-generation-system
./scripts/backup.sh
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞
cd ~/leadgen-backups
tar -xzf latest.tar.gz -C /path/to/restore/location

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ .env
cp latest.env /path/to/restore/location/.env
```

---

## üöÄ –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

### –î–µ–ø–ª–æ–π –Ω–∞ production

```bash
cd /Users/vbut/lead-generation-system
./scripts/deploy.sh production
```

### –î–µ–ø–ª–æ–π –Ω–∞ staging

```bash
./scripts/deploy.sh staging
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ:

1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è (—Ç–µ–≥ —Å timestamp)
3. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–∞–∫–µ—Ç –¥–ª—è –¥–µ–ø–ª–æ—è
4. ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ VPS
5. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–∞ VPS
6. ‚úÖ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
7. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å–µ—Ä–≤–∏—Å—ã
8. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è health check

---

## ‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

### –¢–µ–∫—É—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞

–§–∞–π–ª: `.github/workflows/auto-deploy.yml`

```yaml
schedule:
  - cron: '0 */4 * * *'  # –ö–∞–∂–¥—ã–µ 4 —á–∞—Å–∞
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤:**
```yaml
schedule:
  - cron: '0 */6 * * *'
```

**–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00:**
```yaml
schedule:
  - cron: '0 3 * * *'
```

**–ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞:**
```yaml
schedule:
  - cron: '0 */2 * * *'
```

**–§–æ—Ä–º–∞—Ç cron:** `–º–∏–Ω—É—Ç–∞ —á–∞—Å –¥–µ–Ω—å –º–µ—Å—è—Ü –¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏`

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ–µ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–ø–ª–æ–µ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Actions`
3. –í—ã–±–µ—Ä–∏—Ç–µ workflow `üöÄ Auto Deploy to VPS`
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–µ—Ä—Å–∏–π

```bash
# –ù–∞ GitHub
git tag -l "v*"

# –ù–∞ VPS
ssh user@vps "ls -la /opt/backups/leadgen/"
```

### –õ–æ–≥–∏ –¥–µ–ø–ª–æ—è

```bash
# –õ–æ–≥–∏ GitHub Actions
# –°–º. –≤ —Ä–∞–∑–¥–µ–ª–µ Actions –Ω–∞ GitHub

# –õ–æ–≥–∏ –Ω–∞ VPS
ssh user@vps "cd /opt/lead-generation-system && docker-compose logs -f"
```

---

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –î–µ–ø–ª–æ–π –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Secrets –≤ GitHub Settings
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–ª—é—á –Ω–∞ VPS
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º

### –ü—Ä–æ–±–ª–µ–º–∞: Health check failed

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ VPS
ssh user@vps "cd /opt/lead-generation-system && docker-compose logs api"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç 8000 –æ—Ç–∫—Ä—ã—Ç
ssh user@vps "netstat -tuln | grep 8000"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –†—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–∞ VPS
ssh user@vps "cd /opt/lead-generation-system && docker-compose restart"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
ssh user@vps "ls -t /opt/backups/leadgen/*.tar.gz | tail -n +6 | xargs rm -f"

# –û—á–∏—Å—Ç–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
ssh user@vps "docker system prune -a"
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
2. ‚úÖ –•—Ä–∞–Ω–∏—Ç–µ `.env` —Ñ–∞–π–ª—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ firewall –Ω–∞ VPS
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL/TLS –¥–ª—è production

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall (UFW)

```bash
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 8000/tcp  # API (–∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏)
sudo ufw enable
```

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –¥–µ–ø–ª–æ–µ–º

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ GitHub Secrets
- [ ] SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ VPS
- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ VPS
- [ ] –°–æ–∑–¥–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ VPS
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω `.env` —Ñ–∞–π–ª –Ω–∞ VPS
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω health check endpoint
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall –Ω–∞ VPS
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–≤–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è:

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, Uptime Robot)
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Telegram, Email)
5. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ GitHub Actions
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ VPS
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `ARCHITECTURE.md`
4. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

